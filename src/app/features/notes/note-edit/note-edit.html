<div class="note-edit-container">
  <div class="edit-header">
    <h2>{{ note?.id ? 'Edit Note' : 'Create New Note' }}</h2>
    <div class="header-actions">
      <button mat-button (click)="onCancel()" [disabled]="isLoading">
        Cancel
      </button>
      <button mat-raised-button
              color="primary"
              (click)="onSave()"
              [disabled]="isLoading || noteForm.invalid">
        <mat-spinner *ngIf="isLoading" diameter="20" class="save-spinner"></mat-spinner>
        <mat-icon *ngIf="!isLoading">save</mat-icon>
        {{ isLoading ? 'Saving...' : 'Save' }}
      </button>
    </div>
  </div>

  <form [formGroup]="noteForm" class="note-form">
    <mat-card class="form-card">
      <mat-card-content>
        <!-- Title -->
        <div class="form-section">
          <mat-form-field appearance="outline" class="title-field">
            <mat-label>Note Title</mat-label>
            <input matInput
                   formControlName="title"
                   placeholder="Enter note title..."
                   maxlength="200">
            <mat-hint align="end">{{ noteForm.get('title')?.value?.length || 0 }}/200</mat-hint>
            <mat-error *ngIf="noteForm.get('title')?.invalid && noteForm.get('title')?.touched">
              {{ getErrorMessage('title') }}
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Content -->
        <div class="form-section">
          <mat-form-field appearance="outline" class="content-field">
            <mat-label>Note Content</mat-label>
            <textarea matInput
                      formControlName="content"
                      placeholder="Write your note here..."
                      rows="12"
                      maxlength="5000"></textarea>
            <mat-hint align="end">{{ noteForm.get('content')?.value?.length || 0 }}/5000</mat-hint>
            <mat-error *ngIf="noteForm.get('content')?.invalid && noteForm.get('content')?.touched">
              {{ getErrorMessage('content') }}
            </mat-error>
          </mat-form-field>
        </div>

        <mat-divider></mat-divider>

        <!-- File Upload Section -->
        <div class="form-section">
          <div class="file-section">
            <div class="file-header">
              <h3>Attachment</h3>
              <small>Optional - Attach a document to your note</small>
            </div>

            <!-- Upload new file -->
            <div class="file-upload" *ngIf="!selectedFile && !note?.fileName">
              <input type="file"
                     #fileInput
                     (change)="onFileSelected($event)"
                     accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,.gif,.xls,.xlsx,.ppt,.pptx"
                     hidden>
              <button mat-stroked-button
                      type="button"
                      (click)="fileInput.click()">
                <mat-icon>attach_file</mat-icon>
                Choose File
              </button>
              <div class="file-info">
                <small>Maximum file size: 10MB</small>
                <br>
                <small>Supported formats: PDF, DOC, TXT, Images, Excel, PowerPoint</small>
              </div>
            </div>

            <!-- Selected file -->
            <div class="selected-file" *ngIf="selectedFile">
              <mat-chip-set>
                <mat-chip [removable]="true" (removed)="removeFile()">
                  <mat-icon matChipAvatar>{{ getFileIcon(selectedFile.name) }}</mat-icon>
                  {{ selectedFile.name }}
                  <span class="file-size">({{ formatFileSize(selectedFile.size) }})</span>
                  <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
              </mat-chip-set>
            </div>

            <!-- Existing file -->
            <div class="existing-file" *ngIf="note?.fileName && !selectedFile">
              <mat-chip-set>
                <mat-chip>
                  <mat-icon matChipAvatar>{{ getFileIcon(note?.fileName) }}</mat-icon>
                  {{ note?.fileName }}
                  <small class="existing-label">Existing attachment</small>
                </mat-chip>
              </mat-chip-set>
              <small class="replace-info">
                Choose a new file above to replace the existing attachment
              </small>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </form>
</div>
