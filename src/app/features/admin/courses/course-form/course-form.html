<div class="max-w-4xl mx-auto p-6 bg-white rounded-lg shadow">
  <h1 class="text-3xl font-bold text-gray-900 mb-6">Create New Course</h1>

  <form [formGroup]="courseForm" (ngSubmit)="saveCourse()" class="space-y-6">
    <div>
      <label class="block text-sm font-semibold text-gray-700 mb-2">Title</label>
      <input
        formControlName="title"
        placeholder="Course Title"
        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-amber-600 focus:border-amber-600">
      @if (courseForm.get('title')?.invalid && courseForm.get('title')?.touched) {
        <span class="text-xs text-red-600 mt-1 block">Title is required</span>
      }
    </div>

    <div>
      <label class="block text-sm font-semibold text-gray-700 mb-2">Description</label>
      <textarea
        formControlName="description"
        placeholder="Course Description"
        rows="5"
        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-amber-600 focus:border-amber-600 resize-y"></textarea>
    </div>

    <div>
      <label class="block text-sm font-semibold text-gray-700 mb-2">Category</label>
      <select
        formControlName="categoryId"
        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-amber-600 focus:border-amber-600">
        <option [value]="null" disabled>Select a category</option>
        @for (cat of categories; track cat.id) {
          <option [value]="cat.id">{{ cat.name }}</option>
        }
      </select>
      @if (courseForm.get('categoryId')?.invalid && courseForm.get('categoryId')?.touched) {
        <span class="text-xs text-red-600 mt-1 block">Category is required</span>
      }
    </div>

    <!-- Thumbnail Upload Section -->
    <div>
      <label class="block text-sm font-semibold text-gray-700 mb-2">Course Thumbnail</label>
      
      @if (!thumbnailPreview) {
        <div class="border-2 border-dashed border-gray-300 rounded-md p-6 text-center hover:border-amber-600 transition">
          <input
            type="file"
            accept="image/*"
            (change)="onThumbnailSelected($event)"
            class="hidden"
            #thumbnailInput>
          
          <div class="space-y-2">
            <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
              <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <div class="text-sm text-gray-600">
              <button
                type="button"
                (click)="thumbnailInput.click()"
                class="font-medium text-amber-700 hover:text-amber-800 focus:outline-none">
                Upload a thumbnail
              </button>
              <span class="text-gray-500"> or drag and drop</span>
            </div>
            <p class="text-xs text-gray-500">PNG, JPG, GIF up to 5MB</p>
          </div>
        </div>
      } @else {
        <div class="relative">
          <img
            [src]="thumbnailPreview"
            alt="Thumbnail preview"
            class="w-full h-64 object-cover rounded-md border border-gray-300">
          
          <button
            type="button"
            (click)="removeThumbnail()"
            class="absolute top-2 right-2 bg-red-600 text-white p-2 rounded-full hover:bg-red-700 transition shadow-lg">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
          
          <div class="mt-2 text-sm text-gray-600">
            <span class="font-medium">{{ selectedThumbnailFile?.name }}</span>
            <span class="text-gray-500"> ({{ (selectedThumbnailFile?.size || 0) / 1024 | number:'1.0-0' }} KB)</span>
          </div>
        </div>
      }
      
      <p class="mt-2 text-xs text-gray-500">
        If no thumbnail is uploaded, a default placeholder image will be used.
      </p>
    </div>

    <div>
      <label class="block text-sm font-semibold text-gray-700 mb-2">Estimated Hours</label>
      <input
        type="number"
        formControlName="estimatedHours"
        min="0"
        step="0.5"
        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-amber-600 focus:border-amber-600">
    </div>

    <div class="flex gap-3">
      <button
        type="submit"
        [disabled]="!courseForm.valid || isLoading"
        class="px-6 py-2 bg-amber-700 text-white rounded-md font-medium hover:bg-amber-800 disabled:opacity-50 disabled:cursor-not-allowed transition">
        {{ isLoading ? 'Creating...' : 'Create Course' }}
      </button>
      <button
        type="button"
        (click)="cancel()"
        [disabled]="isLoading"
        class="px-6 py-2 bg-gray-600 text-white rounded-md font-medium hover:bg-gray-700 disabled:opacity-50 transition">
        Cancel
      </button>
    </div>
  </form>
</div>

@if (isLoading) {
  <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg">
      <div class="flex items-center space-x-3">
        <svg class="animate-spin h-5 w-5 text-amber-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <p class="text-gray-700">Creating course...</p>
      </div>
    </div>
  </div>
}